<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Ink API Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            overflow: hidden;
            background: white;
        }
        
        #canvas {
            display: block;
            background: white;
            cursor: crosshair;
        }
        
        #error {
            position: fixed;
            top: 20px;
            left: 20px;
            background: #ffebee;
            color: #c62828;
            padding: 10px;
            border-radius: 4px;
            display: none;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div id="error">Ink API not supported in this browser</div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const errorDiv = document.getElementById('error');
        
        // Set canvas to fullscreen
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        // Resize canvas when window resizes
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });
        
        let presenter = null;
        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;
        
        // Initialize Ink API
        async function initInkAPI() {
            if (navigator.ink) {
                try {
                    presenter = await navigator.ink.requestPresenter({ presentationArea: canvas });
                    console.log('Ink API ready');
                } catch (err) {
                    console.error('Ink API failed:', err);
                    errorDiv.textContent = 'Ink API failed to initialize';
                    errorDiv.style.display = 'block';
                }
            } else {
                errorDiv.style.display = 'block';
                console.log('Ink API not supported');
            }
        }
        
        initInkAPI();
        
        function startDrawing(x, y) {
            isDrawing = true;
            lastX = x;
            lastY = y;
            
            // Set stroke properties
            ctx.strokeStyle = 'black';
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
        }
        
        function draw(x, y) {
            if (!isDrawing) return;
            
            // Draw only the new segment from last position to current
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(x, y);
            ctx.stroke();
            
            // Update last position
            lastX = x;
            lastY = y;
        }
        
        function stopDrawing() {
            isDrawing = false;
            // Path will be automatically closed when we start a new one
        }
        
        // Pointer Events (with Ink API support) - Only pen and mouse, no finger
        canvas.addEventListener('pointerdown', (evt) => {
            evt.preventDefault();
            // Only allow pen and mouse, block finger touches
            if (evt.pointerType === 'touch') return;
            startDrawing(evt.offsetX, evt.offsetY);
            
            // Initialize Ink API trail on pen down only
            if (presenter) {
                try {
                    presenter.updateInkTrailStartPoint(evt, {
                        color: 'black',
                        diameter: 2
                    });
                } catch (err) {
                    console.error('Ink API update failed:', err);
                }
            }
        });
        
        canvas.addEventListener('pointermove', (evt) => {
            evt.preventDefault();
            // Only allow pen and mouse, block finger touches
            if (evt.pointerType === 'touch') return;
            draw(evt.offsetX, evt.offsetY);
            
            // Update Ink API less frequently to reduce thick tip effect
            if (presenter && isDrawing) {
                try {
                    presenter.updateInkTrailStartPoint(evt, {
                        color: 'black',
                        diameter: 2
                    });
                } catch (err) {
                    console.error('Ink API update failed:', err);
                }
            }
        });
        
        canvas.addEventListener('pointerup', (evt) => {
            evt.preventDefault();
            // Only allow pen and mouse, block finger touches
            if (evt.pointerType === 'touch') return;
            stopDrawing();
        });
        
        canvas.addEventListener('pointerleave', (evt) => {
            evt.preventDefault();
            // Only allow pen and mouse, block finger touches
            if (evt.pointerType === 'touch') return;
            stopDrawing();
        });
        
        // Mouse Events (fallback - no Ink API)
        canvas.addEventListener('mousedown', (evt) => {
            evt.preventDefault();
            startDrawing(evt.offsetX, evt.offsetY);
        });
        
        canvas.addEventListener('mousemove', (evt) => {
            evt.preventDefault();
            draw(evt.offsetX, evt.offsetY);
        });
        
        canvas.addEventListener('mouseup', (evt) => {
            evt.preventDefault();
            stopDrawing();
        });
        
        canvas.addEventListener('mouseleave', (evt) => {
            evt.preventDefault();
            stopDrawing();
        });
        
        // Prevent touch events (disable finger drawing)
        canvas.addEventListener('touchstart', (evt) => {
            evt.preventDefault();
        });
        
        canvas.addEventListener('touchmove', (evt) => {
            evt.preventDefault();
        });
        
        canvas.addEventListener('touchend', (evt) => {
            evt.preventDefault();
        });
        
        // Clear canvas on double click
        canvas.addEventListener('dblclick', () => {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        });
    </script>
</body>
</html>
