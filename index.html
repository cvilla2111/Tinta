<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minimal Draw Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"></link>
    <link rel="manifest" href="manifest.json">
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            touch-action: none;
        }
        
        #canvas {
            touch-action: none;
            cursor: crosshair;
        }
        
        #previewCanvas {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 10;
        }
        
        .tool-button {
            transition: all 0.2s ease;
        }
        
        .tool-button:hover {
            transform: scale(1.05);
        }
        
        .tool-button.active {
            background-color: rgba(255, 255, 255, 0.95);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
        }
        
        .pressure-indicator {
            position: absolute;
            right: 20px;
            bottom: 80px;
            width: 120px;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 12px;
            padding: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        
        .pressure-indicator.show {
            opacity: 1;
        }
        
        .pressure-dot {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #3b82f6;
            transition: all 0.1s ease;
            margin-bottom: 8px;
        }
        
        .pressure-level {
            font-size: 12px;
            font-weight: 500;
            color: #374151;
            text-align: center;
        }
        
        .settings-panel {
            position: fixed;
            top: 0;
            right: -320px;
            width: 320px;
            height: 100vh;
            background: white;
            box-shadow: -4px 0 12px rgba(0, 0, 0, 0.1);
            transition: right 0.3s ease;
            z-index: 1000;
            padding: 24px;
            overflow-y: auto;
        }
        
        .settings-panel.open {
            right: 0;
        }
        
        .slider-container {
            margin-bottom: 24px;
        }
        
        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
            color: #374151;
        }
        
        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #e5e7eb;
            outline: none;
            appearance: none;
        }
        
        .slider::-webkit-slider-thumb {
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
        }
        
        .slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            border: none;
        }
        
        /* Toggle Switch Styles */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: #3b82f6;
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Home Screen -->
    <div id="homeScreen" class="h-screen w-full flex items-center justify-center bg-white">
        <button id="startButton" class="px-8 py-4 bg-blue-500 text-white rounded-full font-medium hover:bg-blue-600 transition-colors shadow-lg">
            Start Drawing
        </button>
    </div>
    
    <!-- Canvas Screen -->
    <div id="canvasScreen" class="hidden h-screen w-full bg-white relative">
        <canvas id="canvas" class="w-full h-full absolute top-0 left-0"></canvas>
        <canvas id="previewCanvas" class="w-full h-full absolute top-0 left-0"></canvas>
        
        <!-- Pressure Level Indicator -->
        <div class="pressure-indicator" id="pressureIndicator">
            <div class="pressure-dot" id="pressureDot"></div>
            <div class="pressure-level">Pressure: 0%</div>
        </div>
        
        <!-- Toolbar -->
        <div class="absolute bottom-6 left-1/2 transform -translate-x-1/2 flex space-x-3 px-4">
            <button class="tool-button active bg-white rounded-full p-4 shadow-md" data-tool="pen" title="Pen">
                <i class="fas fa-pen text-xl text-gray-700"></i>
            </button>
            <button class="tool-button bg-white rounded-full p-4 shadow-md" data-tool="eraser" title="Eraser">
                <i class="fas fa-eraser text-xl text-gray-700"></i>
            </button>
            <button class="tool-button bg-white rounded-full p-4 shadow-md" data-tool="clear" title="Clear">
                <i class="fas fa-trash-alt text-xl text-gray-700"></i>
            </button>
            <button class="tool-button bg-white rounded-full p-4 shadow-md" data-tool="color" title="Color">
                <div class="w-6 h-6 bg-black rounded-full border-2 border-gray-300"></div>
            </button>
            <button class="tool-button bg-white rounded-full p-4 shadow-md" data-tool="size" title="Size">
                <div class="w-6 h-6 bg-gray-200 rounded-full border-2 border-gray-400"></div>
            </button>
            <button class="tool-button bg-white rounded-full p-4 shadow-md" data-tool="pressure" title="Pressure Settings">
                <i class="fas fa-sliders-h text-xl text-gray-700"></i>
            </button>
        </div>
    </div>
    
    <!-- Settings Panel -->
    <div class="settings-panel" id="settingsPanel">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-lg font-semibold text-gray-800">Pressure Settings</h2>
            <button id="closeSettings" class="text-gray-500 hover:text-gray-700">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        
        <div class="slider-container">
            <div class="slider-label">
                <span>Min Line Thickness</span>
                <span id="minThicknessValue">1px</span>
            </div>
            <input type="range" min="1" max="80" value="1" class="slider" id="minThicknessSlider">
        </div>
        
        <div class="slider-container">
            <div class="slider-label">
                <span>Max Line Thickness</span>
                <span id="maxThicknessValue">18px</span>
            </div>
            <input type="range" min="5" max="80" value="18" class="slider" id="maxThicknessSlider">
        </div>
        
        <div class="slider-container">
            <div class="slider-label">
                <span>Pressure Sensitivity</span>
                <span id="sensitivityValue">40%</span>
            </div>
            <input type="range" min="10" max="100" value="40" class="slider" id="sensitivitySlider">
        </div>
        
        <div class="slider-container">
            <div class="slider-label">
                <span>Enable Pressure Sensitivity</span>
            </div>
            <label class="toggle-switch">
                <input type="checkbox" id="pressureToggle" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>
        
        <div class="mt-8 pt-6 border-t border-gray-200">
            <h3 class="font-medium text-gray-700 mb-4">Preview</h3>
            <div class="flex justify-center items-center h-32 bg-gray-50 rounded-lg">
                <div class="text-center">
                    <div class="mb-2 text-sm text-gray-500">Light Pressure</div>
                    <div class="w-8 h-8 bg-gray-300 rounded-full mx-auto mb-4"></div>
                    <div class="mb-2 text-sm text-gray-500">Medium Pressure</div>
                    <div class="w-12 h-12 bg-gray-400 rounded-full mx-auto mb-4"></div>
                    <div class="mb-2 text-sm text-gray-500">Heavy Pressure</div>
                    <div class="w-16 h-16 bg-gray-500 rounded-full mx-auto"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            // App state
            const appState = {
                isDrawing: false,
                currentTool: 'pen',
                currentColor: '#000000',
                baseSize: 5,
                currentSize: 5,
                pressureEnabled: true,
                minThickness: 1,
                maxThickness: 18,
                sensitivity: 0.4,
                strokePoints: [],
                lastPoint: null
            };
            
            // DOM elements
            const homeScreen = document.getElementById('homeScreen');
            const canvasScreen = document.getElementById('canvasScreen');
            const startButton = document.getElementById('startButton');
            const pressureIndicator = document.getElementById('pressureIndicator');
            const pressureDot = document.getElementById('pressureDot');
            const pressureLevel = document.querySelector('.pressure-level');
            const settingsPanel = document.getElementById('settingsPanel');
            const closeSettings = document.getElementById('closeSettings');
            const pressureToggle = document.getElementById('pressureToggle');
            
            // Canvas elements
            let canvas, ctx, previewCanvas, previewCtx;
            
            // Event listeners
            startButton.addEventListener('click', initializeApp);
            closeSettings.addEventListener('click', () => settingsPanel.classList.remove('open'));
            pressureToggle.addEventListener('change', () => {
                appState.pressureEnabled = pressureToggle.checked;
            });
            
            // Tool buttons
            document.querySelectorAll('.tool-button').forEach(button => {
                button.addEventListener('click', () => handleToolSelection(button));
            });
            
            // Settings sliders
            document.getElementById('minThicknessSlider').addEventListener('input', updateSetting);
            document.getElementById('maxThicknessSlider').addEventListener('input', updateSetting);
            document.getElementById('sensitivitySlider').addEventListener('input', updateSetting);
            
            function initializeApp() {
                homeScreen.style.display = 'none';
                canvasScreen.style.display = 'block';
                initCanvases();
                setupDrawingEvents();
            }
            
            function initCanvases() {
                canvas = document.getElementById('canvas');
                previewCanvas = document.getElementById('previewCanvas');
                ctx = canvas.getContext('2d');
                previewCtx = previewCanvas.getContext('2d');
                
                resizeCanvas();
                resizePreviewCanvas();
                
                window.addEventListener('resize', () => {
                    resizeCanvas();
                    resizePreviewCanvas();
                });
            }
            
            function resizeCanvas() {
                const dpr = window.devicePixelRatio || 1;
                const rect = canvas.getBoundingClientRect();
                
                canvas.width = rect.width * dpr;
                canvas.height = rect.height * dpr;
                canvas.style.width = rect.width + 'px';
                canvas.style.height = rect.height + 'px';
                
                ctx.scale(dpr, dpr);
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
            }
            
            function resizePreviewCanvas() {
                const dpr = window.devicePixelRatio || 1;
                const rect = previewCanvas.getBoundingClientRect();
                
                previewCanvas.width = rect.width * dpr;
                previewCanvas.height = rect.height * dpr;
                previewCanvas.style.width = rect.width + 'px';
                previewCanvas.style.height = rect.height + 'px';
                
                previewCtx.scale(dpr, dpr);
                previewCtx.lineCap = 'round';
                previewCtx.lineJoin = 'round';
            }
            
            function setupDrawingEvents() {
                canvas.addEventListener('pointerdown', startDrawing);
                canvas.addEventListener('pointermove', draw);
                canvas.addEventListener('pointerup', stopDrawing);
                canvas.addEventListener('pointercancel', stopDrawing);
                canvas.addEventListener('pointerleave', stopDrawing);
                
                canvas.addEventListener('pointerdown', showPressureIndicator);
                canvas.addEventListener('pointerup', hidePressureIndicator);
                canvas.addEventListener('pointermove', updatePressureIndicator);
                
                canvas.addEventListener('pointermove', updateEraserPreview);
                canvas.addEventListener('pointerleave', clearEraserPreview);
            }
            
            function startDrawing(e) {
                if (appState.currentTool === 'clear') return;
                
                appState.isDrawing = true;
                const pos = getEventPos(e);
                
                appState.strokePoints = [pos];
                appState.lastPoint = pos;
                
                ctx.beginPath();
                ctx.moveTo(pos.x, pos.y);
            }
            
            function draw(e) {
                if (!appState.isDrawing || appState.currentTool === 'clear') return;
                
                const pos = getEventPos(e);
                const pressure = Math.min(e.pressure || 0.5, 1);
                
                // Calculate dynamic size
                appState.currentSize = appState.pressureEnabled 
                    ? appState.minThickness + (pressure * (appState.maxThickness - appState.minThickness) * appState.sensitivity)
                    : appState.minThickness;
                
                // Store point for smoothing
                appState.strokePoints.push(pos);
                
                // Keep only recent points
                if (appState.strokePoints.length > 5) {
                    appState.strokePoints.shift();
                }
                
                // Draw smoothed line
                if (appState.strokePoints.length >= 2) {
                    const prevPoint = appState.strokePoints[appState.strokePoints.length - 2];
                    const currPoint = appState.strokePoints[appState.strokePoints.length - 1];
                    
                    // Control point for smooth curve
                    const cpX = (prevPoint.x + currPoint.x) / 2;
                    const cpY = (prevPoint.y + currPoint.y) / 2;
                    
                    ctx.lineWidth = appState.currentSize;
                    ctx.strokeStyle = appState.currentTool === 'eraser' ? '#FFFFFF' : appState.currentColor;
                    
                    // Draw curved segment
                    ctx.quadraticCurveTo(prevPoint.x, prevPoint.y, cpX, cpY);
                    ctx.stroke();
                    
                    // Move to next point
                    ctx.beginPath();
                    ctx.moveTo(cpX, cpY);
                }
                
                appState.lastPoint = pos;
            }
            
            function stopDrawing() {
                if (appState.isDrawing) {
                    appState.isDrawing = false;
                    ctx.closePath();
                }
            }
            
            function getEventPos(e) {
                const rect = canvas.getBoundingClientRect();
                return {
                    x: e.clientX - rect.left,
                    y: e.clientY - rect.top
                };
            }
            
            function showPressureIndicator() {
                pressureIndicator.classList.add('show');
            }
            
            function hidePressureIndicator() {
                pressureIndicator.classList.remove('show');
            }
            
            function updatePressureIndicator(e) {
                if (!appState.isDrawing) return;
                
                const pressure = Math.round((e.pressure || 0.5) * 100);
                pressureDot.style.transform = `scale(${e.pressure || 0.5})`;
                pressureLevel.textContent = `Pressure: ${pressure}%`;
            }
            
            function updateEraserPreview(e) {
                if (appState.currentTool !== 'eraser') return;
                
                const pos = getEventPos(e);
                const pressure = Math.min(e.pressure || 0.5, 1);
                appState.currentSize = appState.pressureEnabled 
                    ? appState.minThickness + (pressure * (appState.maxThickness - appState.minThickness) * appState.sensitivity)
                    : appState.minThickness;
                
                // Clear previous preview
                previewCtx.clearRect(0, 0, previewCanvas.width, previewCanvas.height);
                
                // Draw dotted circle
                previewCtx.save();
                previewCtx.setLineDash([3, 3]);
                previewCtx.strokeStyle = '#666';
                previewCtx.lineWidth = 1;
                previewCtx.beginPath();
                previewCtx.arc(pos.x, pos.y, appState.currentSize / 2, 0, Math.PI * 2);
                previewCtx.stroke();
                previewCtx.restore();
            }
            
            function clearEraserPreview() {
                previewCtx.clearRect(0, 0, previewCanvas.width, previewCanvas.height);
            }
            
            function handleToolSelection(button) {
                const tool = button.dataset.tool;
                
                if (tool === 'clear') {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    previewCtx.clearRect(0, 0, previewCanvas.width, previewCanvas.height);
                    return;
                }
                
                if (tool === 'pressure') {
                    settingsPanel.classList.toggle('open');
                    return;
                }
                
                // Update active state
                document.querySelectorAll('.tool-button').forEach(b => b.classList.remove('active'));
                button.classList.add('active');
                appState.currentTool = tool;
                
                // Clear preview
                previewCtx.clearRect(0, 0, previewCanvas.width, previewCanvas.height);
                
                // Handle special tools
                if (tool === 'color') {
                    const newColor = prompt('Enter color (hex):', appState.currentColor);
                    if (newColor && /^#[0-9A-F]{6}$/i.test(newColor)) {
                        appState.currentColor = newColor;
                        button.querySelector('div').style.backgroundColor = newColor;
                    }
                }
                
                if (tool === 'size') {
                    const newSize = parseInt(prompt('Enter brush size (1-20):', appState.baseSize));
                    if (newSize >= 1 && newSize <= 20) {
                        appState.baseSize = newSize;
                        button.querySelector('div').style.width = `${newSize}px`;
                        button.querySelector('div').style.height = `${newSize}px`;
                    }
                }
            }
            
            function updateSetting() {
                const sliderId = event.target.id;
                const value = parseInt(event.target.value);
                
                switch (sliderId) {
                    case 'minThicknessSlider':
                        appState.minThickness = value;
                        document.getElementById('minThicknessValue').textContent = `${value}px`;
                        break;
                    case 'maxThicknessSlider':
                        appState.maxThickness = value;
                        document.getElementById('maxThicknessValue').textContent = `${value}px`;
                        break;
                    case 'sensitivitySlider':
                        appState.sensitivity = value / 100;
                        document.getElementById('sensitivityValue').textContent = `${value}%`;
                        break;
                }
            }
            
            // Register service worker
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js')
                    .then(reg => console.log('Service Worker registered'))
                    .catch(err => console.error('Service Worker registration failed:', err));
            }
        });
    </script>
</body>
</html>
