<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minimal Draw Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="manifest" href="manifest.json">
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            touch-action: none;
        }
        
        #canvas {
            touch-action: none;
            cursor: crosshair;
        }
        
        .tool-button {
            transition: all 0.2s ease;
        }
        
        .tool-button:hover {
            transform: scale(1.05);
        }
        
        .tool-button.active {
            background-color: rgba(255, 255, 255, 0.95);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
        }
        
        /* Pressure indicator */
        .pressure-indicator {
            position: absolute;
            right: 20px;
            bottom: 80px;
            width: 120px;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 12px;
            padding: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        
        .pressure-indicator.show {
            opacity: 1;
        }
        
        .pressure-dot {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #3b82f6;
            transition: all 0.1s ease;
            margin-bottom: 8px;
        }
        
        .pressure-level {
            font-size: 12px;
            font-weight: 500;
            color: #374151;
            text-align: center;
        }
        
        /* Settings Panel */
        .settings-panel {
            position: fixed;
            top: 0;
            right: -320px;
            width: 320px;
            height: 100vh;
            background: white;
            box-shadow: -4px 0 12px rgba(0, 0, 0, 0.1);
            transition: right 0.3s ease;
            z-index: 1000;
            padding: 24px;
            overflow-y: auto;
        }
        
        .settings-panel.open {
            right: 0;
        }
        
        .slider-container {
            margin-bottom: 24px;
        }
        
        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
            color: #374151;
        }
        
        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #e5e7eb;
            outline: none;
            appearance: none;
        }
        
        .slider::-webkit-slider-thumb {
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
        }
        
        .slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            border: none;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Home Screen -->
    <div id="homeScreen" class="h-screen w-full flex items-center justify-center bg-white">
        <button id="startButton" class="px-8 py-4 bg-blue-500 text-white rounded-full font-medium hover:bg-blue-600 transition-colors shadow-lg">
            Start Drawing
        </button>
    </div>
    <!-- Canvas Screen -->
    <div id="canvasScreen" class="hidden h-screen w-full bg-white relative">
        <canvas id="canvas" class="w-full h-full absolute top-0 left-0"></canvas>
        
        <!-- Pressure Level Indicator -->
        <div class="pressure-indicator" id="pressureIndicator">
            <div class="pressure-dot" id="pressureDot"></div>
            <div class="pressure-level">Pressure: 0%</div>
        </div>
        
        <!-- Toolbar -->
        <div class="absolute bottom-6 left-1/2 transform -translate-x-1/2 flex space-x-3 px-4">
            <button class="tool-button active bg-white rounded-full p-4 shadow-md" data-tool="pen" title="Pen">
                <i class="fas fa-pen text-xl text-gray-700"></i>
            </button>
            <button class="tool-button bg-white rounded-full p-4 shadow-md" data-tool="eraser" title="Eraser">
                <i class="fas fa-eraser text-xl text-gray-700"></i>
            </button>
            <button class="tool-button bg-white rounded-full p-4 shadow-md" data-tool="clear" title="Clear">
                <i class="fas fa-trash-alt text-xl text-gray-700"></i>
            </button>
            <button class="tool-button bg-white rounded-full p-4 shadow-md" data-tool="color" title="Color">
                <div class="w-6 h-6 bg-black rounded-full border-2 border-gray-300"></div>
            </button>
            <button class="tool-button bg-white rounded-full p-4 shadow-md" data-tool="size" title="Size">
                <div class="w-6 h-6 bg-gray-200 rounded-full border-2 border-gray-400"></div>
            </button>
            <button class="tool-button bg-white rounded-full p-4 shadow-md" data-tool="pressure" title="Pressure Settings">
                <i class="fas fa-sliders-h text-xl text-gray-700"></i>
            </button>
        </div>
    </div>
    <!-- Settings Panel -->
    <div class="settings-panel" id="settingsPanel">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-lg font-semibold text-gray-800">Pressure Settings</h2>
            <button id="closeSettings" class="text-gray-500 hover:text-gray-700">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        
        <div class="slider-container">
            <div class="slider-label">
                <span>Min Line Thickness</span>
                <span id="minThicknessValue">1px</span>
            </div>
            <input type="range" min="1" max="10" value="1" class="slider" id="minThicknessSlider">
        </div>
        
        <div class="slider-container">
            <div class="slider-label">
                <span>Max Line Thickness</span>
                <span id="maxThicknessValue">18px</span>
            </div>
            <input type="range" min="5" max="50" value="18" class="slider" id="maxThicknessSlider">
        </div>
        
        <div class="slider-container">
            <div class="slider-label">
                <span>Pressure Sensitivity</span>
                <span id="sensitivityValue">40%</span>
            </div>
            <input type="range" min="10" max="100" value="40" class="slider" id="sensitivitySlider">
        </div>
        
        <div class="mt-8 pt-6 border-t border-gray-200">
            <h3 class="font-medium text-gray-700 mb-4">Preview</h3>
            <div class="flex justify-center items-center h-32 bg-gray-50 rounded-lg">
                <div class="text-center">
                    <div class="mb-2 text-sm text-gray-500">Light Pressure</div>
                    <div class="w-8 h-8 bg-gray-300 rounded-full mx-auto mb-4"></div>
                    <div class="mb-2 text-sm text-gray-500">Medium Pressure</div>
                    <div class="w-12 h-12 bg-gray-400 rounded-full mx-auto mb-4"></div>
                    <div class="mb-2 text-sm text-gray-500">Heavy Pressure</div>
                    <div class="w-16 h-16 bg-gray-500 rounded-full mx-auto"></div>
                </div>
            </div>
        </div>
    </div>
    <script>
        // Wait for DOM to be fully loaded before initializing
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize variables
            let canvas, ctx;
            let isDrawing = false;
            let currentTool = 'pen';
            let currentColor = '#000000';
            let baseSize = 5;
            let currentSize = baseSize;
            let pressureEnabled = true;
            let lastPoint = null;
            let strokePoints = [];
            
            // Settings variables
            let minThickness = 1;
            let maxThickness = 18;
            let sensitivity = 0.4;
            
            // DOM elements
            const homeScreen = document.getElementById('homeScreen');
            const canvasScreen = document.getElementById('canvasScreen');
            const startButton = document.getElementById('startButton');
            const pressureIndicator = document.getElementById('pressureIndicator');
            const pressureDot = document.getElementById('pressureDot');
            const pressureLevel = document.querySelector('.pressure-level');
            const settingsPanel = document.getElementById('settingsPanel');
            const closeSettings = document.getElementById('closeSettings');
            
            // Initialize canvas when starting
            function initCanvas() {
                canvas = document.getElementById('canvas');
                ctx = canvas.getContext('2d');
                
                // Set canvas size with high DPI support
                resizeCanvas();
                window.addEventListener('resize', resizeCanvas);
                // Setup drawing events with pointer events for pressure support
                setupDrawingEvents();
            }
            
            function resizeCanvas() {
                const dpr = window.devicePixelRatio || 1;
                const rect = canvas.getBoundingClientRect();
                
                canvas.width = rect.width * dpr;
                canvas.height = rect.height * dpr;
                canvas.style.width = rect.width + 'px';
                canvas.style.height = rect.height + 'px';
                
                ctx.scale(dpr, dpr);
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
            }
            
            function setupDrawingEvents() {
                // Pointer events for pressure support
                canvas.addEventListener('pointerdown', startDrawing);
                canvas.addEventListener('pointermove', draw);
                canvas.addEventListener('pointerup', stopDrawing);
                canvas.addEventListener('pointercancel', stopDrawing);
                canvas.addEventListener('pointerleave', stopDrawing);
                
                // Show/hide pressure indicator
                canvas.addEventListener('pointerdown', showPressureIndicator);
                canvas.addEventListener('pointerup', hidePressureIndicator);
                canvas.addEventListener('pointermove', updatePressureIndicator);
            }
            
            function showPressureIndicator() {
                pressureIndicator.classList.add('show');
            }
            
            function hidePressureIndicator() {
                pressureIndicator.classList.remove('show');
            }
            
            function updatePressureIndicator(e) {
                if (pressureEnabled) {
                    const pressure = Math.min(e.pressure || 0.5, 1);
                    const size = minThickness + (pressure * (maxThickness - minThickness) * sensitivity);
                    pressureDot.style.width = size + 'px';
                    pressureDot.style.height = size + 'px';
                    pressureDot.style.opacity = pressure;
                    
                    // Update pressure level text
                    pressureLevel.textContent = `Pressure: ${Math.round(pressure * 100)}%`;
                }
            }
            
            function startDrawing(e) {
                if (currentTool === 'clear') return;
                
                isDrawing = true;
                const pos = getEventPos(e);
                
                // Reset stroke points
                strokePoints = [pos];
                lastPoint = pos;
                
                ctx.beginPath();
                ctx.moveTo(pos.x, pos.y);
            }
            
            function draw(e) {
                if (!isDrawing || currentTool === 'clear') return;
                
                const pos = getEventPos(e);
                const pressure = Math.min(e.pressure || 0.5, 1);
                
                // Calculate dynamic size based on pressure and settings
                currentSize = pressureEnabled ? 
                    minThickness + (pressure * (maxThickness - minThickness) * sensitivity) : 
                    baseSize;
                
                // Store point for smoothing
                strokePoints.push(pos);
                
                // Keep only recent points for smoothing
                if (strokePoints.length > 5) {
                    strokePoints.shift();
                }
                
                // Draw smoothed line
                if (strokePoints.length >= 2) {
                    const prevPoint = strokePoints[strokePoints.length - 2];
                    const currPoint = strokePoints[strokePoints.length - 1];
                    
                    // Calculate control point for smooth curve
                    const cpX = (prevPoint.x + currPoint.x) / 2;
                    const cpY = (prevPoint.y + currPoint.y) / 2;
                    
                    ctx.lineWidth = currentSize;
                    ctx.strokeStyle = currentTool === 'eraser' ? '#FFFFFF' : currentColor;
                    
                    // Draw curved segment
                    ctx.quadraticCurveTo(prevPoint.x, prevPoint.y, cpX, cpY);
                    ctx.stroke();
                    
                    // Move to next point
                    ctx.beginPath();
                    ctx.moveTo(cpX, cpY);
                }
                
                lastPoint = pos;
            }
            
            function stopDrawing() {
                if (isDrawing) {
                    isDrawing = false;
                    ctx.closePath();
                }
            }
            
            function getEventPos(e) {
                const rect = canvas.getBoundingClientRect();
                return {
                    x: e.clientX - rect.left,
                    y: e.clientY - rect.top
                };
            }
            
            // Tool selection
            document.querySelectorAll('.tool-button').forEach(button => {
                button.addEventListener('click', () => {
                    const tool = button.dataset.tool;
                    
                    if (tool === 'clear') {
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                        return;
                    }
                    
                    if (tool === 'pressure') {
                        settingsPanel.classList.toggle('open');
                        return;
                    }
                    
                    // Update active state
                    document.querySelectorAll('.tool-button').forEach(b => b.classList.remove('active'));
                    button.classList.add('active');
                    currentTool = tool;
                });
            });
            
            // Settings panel controls
            document.getElementById('minThicknessSlider').addEventListener('input', (e) => {
                minThickness = parseInt(e.target.value);
                document.getElementById('minThicknessValue').textContent = minThickness + 'px';
            });
            
            document.getElementById('maxThicknessSlider').addEventListener('input', (e) => {
                maxThickness = parseInt(e.target.value);
                document.getElementById('maxThicknessValue').textContent = maxThickness + 'px';
            });
            
            document.getElementById('sensitivitySlider').addEventListener('input', (e) => {
                const value = parseInt(e.target.value);
                sensitivity = value / 100; // Convert percentage to decimal
                document.getElementById('sensitivityValue').textContent = value + '%';
            });
            
            closeSettings.addEventListener('click', () => {
                settingsPanel.classList.remove('open');
            });
            
            // Color picker
            document.querySelector('[data-tool="color"]').addEventListener('click', () => {
                const color = prompt('Enter color (hex):', currentColor);
                if (color && /^#[0-9A-F]{6}$/i.test(color)) {
                    currentColor = color;
                    document.querySelector('[data-tool="color"] div').style.backgroundColor = color;
                }
            });
            
            // Size picker
            document.querySelector('[data-tool="size"]').addEventListener('click', () => {
                const size = parseInt(prompt('Enter brush size (1-20):', baseSize));
                if (size >= 1 && size <= 20) {
                    baseSize = size;
                    document.querySelector('[data-tool="size"] div').style.width = `${size}px`;
                    document.querySelector('[data-tool="size"] div').style.height = `${size}px`;
                }
            });
            
            // Navigation
            startButton.addEventListener('click', () => {
                homeScreen.style.display = 'none';
                canvasScreen.style.display = 'block';
                initCanvas();
            });
            
            // Register Service Worker
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js')
                    .then(reg => console.log('Service Worker registered'))
                    .catch(err => console.error('Service Worker registration failed:', err));
            }
        });
    </script>
</body>
</html>
